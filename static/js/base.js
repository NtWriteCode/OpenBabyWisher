        // Language support
        const translations = {
            en: {
                title: "Baby Wishlist",
                subtitle: "{hero_message}",
                addHint: "I've got this!",
                hintPlaceholder: "Optional: Add a note...",
                sendHint: "Send Hint",
                customMessage: "Custom message",
                predefinedMessage: "Quick message",
                priority: "Priority",
                high: "High",
                medium: "Medium", 
                low: "Low",
                tags: "Tags",
                images: "Images",
                description: "Description",
                hints: "Purchase Hints",
                dismissHint: "Dismiss",
                editItem: "Edit Item",
                deleteItem: "Delete Item",
                saveItem: "Save Item",
                cancelEdit: "Cancel",
                addNewItem: "Add New Item",
                uploadImage: "Upload Image",
                adminPanel: "Admin Panel",
                publicView: "Public View",
                itemDisabled: "Item completed/disabled",
                noItems: "No items in the wishlist yet.",
                iGotThis: "I've got this!",
                someoneGotThis: "Someone's got this!",
                readMore: "Read more",
                readLess: "Read less",
                loading: "Loading...",
                error: "An error occurred",
                success: "Success!",
                confirmDelete: "Are you sure you want to delete this item?",
                // Status translations
                available: "Available",
                claimed: "Claimed",
                completed: "Completed",
                // Hint process translations
                errorSending: "Error sending hint",
                hintSent: "Hint sent successfully!",
                selectOrType: "Select or type your message",
                sendingHint: "Sending hint...",
                hintDescription: "Let others know you're planning to get this gift",
                // Admin auth translations
                authenticating: "Authenticating...",
                authenticationFailed: "Authentication failed",
                loggedOut: "Logged out successfully",
                pleaseAuthenticate: "Please authenticate first",
                tokenRequired: "Admin token is required",
                savingItem: "Saving item...",
                // Admin actions translations
                hintDismissed: "Hint dismissed",
                itemDeleted: "Item deleted",
                itemSaved: "Item saved successfully",
                dismissHintTitle: "Dismiss Notification",
                dismissHintDescription: "What would you like to do with this item?",
                dismissAndComplete: "Mark as Completed",
                dismissOnly: "Just Dismiss",
                itemCompleted: "Item marked as completed",
                markedAsAvailable: "Marked as available",
                markedAsDone: "Marked as done",
                edit: "Edit",
                delete: "Delete",
                // UI elements
                items: "items",
                noItemsDesc: "The wishlist is being prepared with love",
                or: "or",
                quickMessages: "Quick Messages",
                cancel: "Cancel",
                // Admin specific
                adminAuthentication: "Admin Authentication",
                authenticate: "Authenticate",
                authenticated: "Authenticated",
                logout: "Logout",
                tokenPlaceholder: "Enter your admin token",
                titlePlaceholder: "Enter item title",
                descriptionPlaceholder: "Add detailed description",
                tagsPlaceholder: "Enter tags separated by commas",
                imageUrlPlaceholder: "Paste image URL here",
                uploadFiles: "Upload Files",
                takePhoto: "Take Photo",
                addUrl: "Add URL",
                totalItems: "Total Items",
                completedItems: "Completed Items",
                pendingHints: "Pending Hints",
                availableItems: "Available Items",
                wishlistItems: "Wishlist Items",
                welcomeTitle: "Welcome to Your Wishlist!",
                welcomeMessage: "Start adding items to your wishlist",
                addFirstItem: "Add Your First Item",
                dismiss: "Dismiss",
                dismissAll: "Dismiss All"
            },
            hu: {
                title: "Baba Kívánságlista",
                subtitle: "{hero_message}",
                addHint: "Ezt megveszem!",
                hintPlaceholder: "Opcionális: Adj hozzá egy megjegyzést...",
                sendHint: "Jelzés Küldése",
                customMessage: "Egyéni üzenet",
                predefinedMessage: "Gyors üzenet",
                priority: "Prioritás",
                high: "Magas",
                medium: "Közepes",
                low: "Alacsony",
                tags: "Címkék",
                images: "Képek",
                description: "Leírás",
                hints: "Vásárlási Jelzések",
                dismissHint: "Elvetés",
                editItem: "Elem Szerkesztése",
                deleteItem: "Elem Törlése",
                saveItem: "Elem Mentése",
                cancelEdit: "Mégse",
                addNewItem: "Új Elem Hozzáadása",
                uploadImage: "Kép Feltöltése",
                adminPanel: "Admin Panel",
                publicView: "Nyilvános Nézet",
                itemDisabled: "Elem befejezve/letiltva",
                noItems: "Még nincsenek elemek a kívánságlistában.",
                iGotThis: "Megveszem!",
                someoneGotThis: "Valaki megveszi!",
                readMore: "Tovább olvasom",
                readLess: "Kevesebb",
                loading: "Betöltés...",
                error: "Hiba történt",
                success: "Sikeres!",
                confirmDelete: "Biztosan törölni szeretnéd ezt az elemet?",
                // Status translations
                available: "Elérhető",
                claimed: "Lefoglalt",
                completed: "Befejezett",
                // Hint process translations
                errorSending: "Hiba a jelzés küldésekor",
                hintSent: "Jelzés sikeresen elküldve!",
                selectOrType: "Válassz vagy írj üzenetet",
                sendingHint: "Jelzés küldése...",
                hintDescription: "Tudasd másokkal, hogy tervezed megvenni ezt az ajándékot",
                // Admin auth translations
                authenticating: "Hitelesítés...",
                authenticationFailed: "Hitelesítés sikertelen",
                loggedOut: "Sikeresen kijelentkezve",
                pleaseAuthenticate: "Kérjük először hitelesítsd magad",
                tokenRequired: "Admin token szükséges",
                savingItem: "Elem mentése...",
                // Admin actions translations
                hintDismissed: "Jelzés elvetve",
                itemDeleted: "Elem törölve",
                itemSaved: "Elem sikeresen mentve",
                dismissHintTitle: "Értesítés Elvetése",
                dismissHintDescription: "Mit szeretnél tenni ezzel az elemmel?",
                dismissAndComplete: "Befejezettként Jelölés",
                dismissOnly: "Csak Elvetés",
                itemCompleted: "Elem befejezettként jelölve",
                markedAsAvailable: "Elérhetőként megjelölve",
                markedAsDone: "Befejezettként megjelölve",
                edit: "Szerkesztés",
                delete: "Törlés",
                // UI elements
                items: "elemek",
                noItemsDesc: "A kívánságlista szeretettel készül",
                or: "vagy",
                quickMessages: "Gyors Üzenetek",
                cancel: "Mégse",
                // Admin specific
                adminAuthentication: "Admin Hitelesítés",
                authenticate: "Hitelesítés",
                authenticated: "Hitelesítve",
                logout: "Kijelentkezés",
                tokenPlaceholder: "Add meg az admin tokent",
                titlePlaceholder: "Add meg az elem címét",
                descriptionPlaceholder: "Adj hozzá részletes leírást",
                tagsPlaceholder: "Add meg a címkéket vesszővel elválasztva",
                imageUrlPlaceholder: "Illeszd be a kép URL-jét ide",
                uploadFiles: "Fájlok Feltöltése",
                takePhoto: "Fénykép Készítése",
                addUrl: "URL Hozzáadása",
                totalItems: "Összes Elem",
                completedItems: "Befejezett Elemek",
                pendingHints: "Függő Jelzések",
                availableItems: "Elérhető Elemek",
                wishlistItems: "Kívánságlista Elemek",
                welcomeTitle: "Üdvözöljük a Kívánságlistádban!",
                welcomeMessage: "Kezdj el elemeket hozzáadni a kívánságlistádhoz",
                addFirstItem: "Add Hozzá Az Első Elemet",
                dismiss: "Elvetés",
                dismissAll: "Összes Elvetése"
            }
        };
        
        let currentLang = localStorage.getItem('language') || 'en';
        let currentHeroMessage = 'Help friends and family choose the perfect gifts'; // Default fallback
        let personalizedTexts = {}; // Store personalized texts
        
        function t(key) {
            const translation = translations[currentLang][key] || key;
            // Replace {hero_message} placeholder with current hero message
            return translation.replace('{hero_message}', currentHeroMessage);
        }
        
        // Load a random hero message
        async function loadHeroMessage() {
            try {
                const response = await fetch(`/api/hero-message?lang=${currentLang}`);
                const data = await response.json();
                currentHeroMessage = data.message;
                updateUI(); // Refresh UI with new message
            } catch (error) {
                console.error('Error loading hero message:', error);
                // Keep the default message if loading fails
            }
        }
        
        // Load personalized texts
        async function loadPersonalizedTexts() {
            try {
                const response = await fetch(`/api/personalized-texts?lang=${currentLang}`);
                personalizedTexts = await response.json();
                updatePersonalizedUI();
            } catch (error) {
                console.error('Error loading personalized texts:', error);
            }
        }
        
        // Load and set dynamic favicon
        async function loadDynamicFavicon() {
            try {
                const response = await fetch('/api/baby-initial');
                const data = await response.json();
                const initial = data.initial;
                
                const faviconUrl = `data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90' fill='%23667eea'>${initial}</text></svg>`;
                document.getElementById('dynamic-favicon').href = faviconUrl;
            } catch (error) {
                console.error('Error loading favicon:', error);
            }
        }
        
        // Update personalized UI elements
        function updatePersonalizedUI() {
            if (personalizedTexts.page_title) {
                document.getElementById('page-title').textContent = personalizedTexts.page_title;
            }
            if (personalizedTexts.admin_title) {
                const adminTitleEl = document.getElementById('admin-title');
                if (adminTitleEl) {
                    adminTitleEl.textContent = personalizedTexts.admin_title;
                }
            }
        }
        
        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            loadHeroMessage(); // Load new message for the new language
            loadPersonalizedTexts(); // Load new personalized texts for the new language
            updateLanguageToggle();
        }
        
        function updateUI() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (el.tagName === 'INPUT' && el.type !== 'button') {
                    el.placeholder = t(key);
                } else {
                    el.textContent = t(key);
                }
            });
        }
        
        // Initialize language on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateLanguageToggle();
            loadHeroMessage(); // Load hero message first, which will call updateUI()
            loadPersonalizedTexts(); // Load personalized texts
        });
        
        function updateLanguageToggle() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === currentLang);
            });
        }
        
        // Tag color generation based on hash
        function hashTagName(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return Math.abs(hash);
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function getLuminance(r, g, b) {
            // Convert RGB to relative luminance using WCAG formula
            const [rs, gs, bs] = [r, g, b].map(c => {
                c = c / 255;
                return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
            });
            return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
        }

        function getContrastColor(backgroundColor) {
            const rgb = hexToRgb(backgroundColor);
            if (!rgb) return '#ffffff'; // fallback to white
            
            const luminance = getLuminance(rgb.r, rgb.g, rgb.b);
            // Use dark text for light backgrounds (luminance > 0.5)
            return luminance > 0.5 ? '#2d3748' : '#ffffff';
        }

        function getTagColor(tagName) {
            const hash = hashTagName(tagName.toLowerCase());
            
            // Define a vibrant, colorful palette with reduced saturation for readability
            const colorfulPalette = [
                // Reds & Pinks
                '#e57373', // Soft Red
                '#f06292', // Soft Pink
                '#ad7a99', // Dusty Rose
                '#c48b9f', // Mauve
                
                // Oranges & Corals
                '#ffb74d', // Soft Orange
                '#ff8a65', // Soft Coral
                '#d4a574', // Peach
                '#e6a85c', // Apricot
                
                // Yellows & Golds
                '#fff176', // Soft Yellow
                '#dcc866', // Gold
                '#d4c441', // Mustard
                '#c9b037', // Brass
                
                // Greens
                '#81c784', // Soft Green
                '#a5d6a7', // Light Green
                '#66bb6a', // Forest Green
                '#7cb342', // Lime Green
                '#689f38', // Olive Green
                '#558b2f', // Dark Green
                
                // Teals & Cyans
                '#4db6ac', // Teal
                '#26a69a', // Dark Teal
                '#00acc1', // Cyan
                '#0097a7', // Dark Cyan
                
                // Blues
                '#64b5f6', // Soft Blue
                '#42a5f5', // Sky Blue
                '#2196f3', // Blue
                '#1976d2', // Dark Blue
                '#1565c0', // Navy Blue
                '#0d47a1', // Deep Blue
                
                // Purples & Violets
                '#ba68c8', // Soft Purple
                '#ab47bc', // Medium Purple
                '#9c27b0', // Purple
                '#7b1fa2', // Dark Purple
                '#673ab7', // Deep Purple
                '#5e35b1', // Indigo
                
                // Browns & Earth Tones
                '#a1887f', // Soft Brown
                '#8d6e63', // Medium Brown
                '#795548', // Brown
                '#6d4c41', // Dark Brown
                '#5d4037', // Deep Brown
                
                // Additional Unique Colors
                '#f8bbd9', // Light Pink
                '#e1bee7', // Light Purple
                '#c5cae9', // Light Indigo
                '#bbdefb', // Light Blue
                '#b2dfdb', // Light Teal
                '#c8e6c9', // Light Green
                '#dcedc8', // Pale Green
                '#f0f4c3', // Pale Lime
                '#fff9c4', // Pale Yellow
                '#ffecb3', // Pale Orange
                '#ffccbc', // Pale Peach
                '#d7ccc8', // Pale Brown
            ];
            
            const colorIndex = hash % colorfulPalette.length;
            return colorfulPalette[colorIndex];
        }

        function applyTagColors() {
            // Apply colors to all tag items
            document.querySelectorAll('.tag-item').forEach(tagElement => {
                const tagText = tagElement.textContent.trim();
                if (tagText) {
                    const backgroundColor = getTagColor(tagText);
                    const textColor = getContrastColor(backgroundColor);
                    
                    tagElement.style.backgroundColor = backgroundColor;
                    tagElement.style.color = textColor;
                    
                    // Adjust text shadow based on text color
                    if (textColor === '#2d3748') {
                        // Dark text on light background - use light shadow
                        tagElement.style.textShadow = '0 1px 2px rgba(255, 255, 255, 0.8)';
                    } else {
                        // White text on dark background - use dark shadow
                        tagElement.style.textShadow = '0 1px 2px rgba(0, 0, 0, 0.4)';
                    }
                }
            });
            
            // Apply colors to tag input pills
            document.querySelectorAll('.tag-input-pill').forEach(pillElement => {
                const tagText = pillElement.querySelector('span:first-child')?.textContent.trim();
                if (tagText) {
                    const backgroundColor = getTagColor(tagText);
                    const textColor = getContrastColor(backgroundColor);
                    
                    pillElement.style.backgroundColor = backgroundColor;
                    pillElement.style.color = textColor;
                    
                    // Adjust text shadow based on text color
                    if (textColor === '#2d3748') {
                        // Dark text on light background - use light shadow
                        pillElement.style.textShadow = '0 1px 2px rgba(255, 255, 255, 0.8)';
                    } else {
                        // White text on dark background - use dark shadow
                        pillElement.style.textShadow = '0 1px 2px rgba(0, 0, 0, 0.4)';
                    }
                }
            });
        }

        // Utility functions
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const icons = {
                success: '<i class="fas fa-check-circle text-green-500"></i>',
                error: '<i class="fas fa-exclamation-circle text-red-500"></i>',
                warning: '<i class="fas fa-exclamation-triangle text-yellow-500"></i>',
                info: '<i class="fas fa-info-circle text-blue-500"></i>'
            };
            
            toast.className = 'toast-modern flex items-center gap-3 animate-slide-in';
            toast.innerHTML = `
                ${icons[type] || icons.info}
                <span class="font-medium">${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-2 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease-out forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        function createLoadingSkeleton(count = 3) {
            let skeleton = '';
            for (let i = 0; i < count; i++) {
                skeleton += `
                    <div class="glass-card p-6 animate-pulse">
                        <div class="loading-skeleton h-6 w-3/4 mb-4 rounded-lg"></div>
                        <div class="loading-skeleton h-4 w-1/2 mb-2 rounded"></div>
                        <div class="loading-skeleton h-20 w-full rounded-lg"></div>
                    </div>
                `;
            }
            return skeleton;
        }
        
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString(currentLang === 'hu' ? 'hu-HU' : 'en-US');
        }

        // Function to convert URLs in plain text to clickable links
        // Note: Not used for descriptions since Quill editor handles link creation
        function linkifyUrls(text) {
            if (!text) return text;
            
            // Skip if text already contains HTML (likely from rich editor)
            if (text.includes('<a') || text.includes('</a>')) {
                return text;
            }
            
            // URL regex pattern that matches http/https URLs
            const urlRegex = /(https?:\/\/[^\s<>"{}|\\^`[\]]+)/gi;
            
            return text.replace(urlRegex, function(url) {
                // Clean up common punctuation at the end of URLs
                let cleanUrl = url;
                let trailingPunctuation = '';
                
                // Check for trailing punctuation and remove it from the URL
                const trailingPunctuationRegex = /([.!?;,]+)$/;
                const match = cleanUrl.match(trailingPunctuationRegex);
                if (match) {
                    trailingPunctuation = match[1];
                    cleanUrl = cleanUrl.slice(0, -trailingPunctuation.length);
                }
                
                // Create a display text (truncate very long URLs)
                let displayText = cleanUrl;
                if (cleanUrl.length > 50) {
                    displayText = cleanUrl.substring(0, 47) + '...';
                }
                
                return `<a href="${cleanUrl}" target="_blank" rel="noopener noreferrer" title="${cleanUrl}">${displayText}</a>${trailingPunctuation}`;
            });
        }
